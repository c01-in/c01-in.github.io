import{r as d,j as s,C as Y}from"./index-Bmoy1e3W.js";import F from"./gpu-DRVrQAfa.js";import G from"./arrow-left-right-B9Ctwolp.js";import q from"./scan-line-C6zAlNnn.js";import K from"./monitor-DJsUvfDV.js";import V from"./blocks-DGRj_35e.js";import Z from"./layers-D4KI1VuB.js";import J from"./square-stack-D3mWGHeZ.js";import Q from"./scroll-text-BeRKCrvX.js";function xe(){const L=d.useRef(null),C=d.useRef(null),[M,N]=d.useState(null),[b,A]=d.useState(null),S={width:1024,height:768},u=S.width+0,z=S.height+0,g=d.useMemo(()=>[{id:"appRender",title:"App Render Trigger",label:"App Trigger",subtitle:"sender app",x:10,y:100,w:156,h:176,icon:"click",shape:"square",neon:"magenta",iconScale:1.2},{id:"macBypass",title:"Wi‑Fi MAC Bypass",label:"MAC Bypass",subtitle:"MAC path",x:20,y:350,w:136,h:156,icon:"swap"},{id:"afxdp",title:"AF_XDP Zero‑Copy",label:"AF_XDP",subtitle:"user‑space",x:220,y:350,w:136,h:156,icon:"xdp"},{id:"decoder",title:"Line‑based Decoder",label:"Line Decoder",subtitle:"decode",x:420,y:350,w:136,h:156,icon:"scan"},{id:"displayCtrl",title:"Display Controller",label:"Display Ctrl",subtitle:"KMS plane",x:620,y:350,w:136,h:156,icon:"blocks"},{id:"uiOverlay",title:"UI Overlay (GPU)",label:"Independent UI",subtitle:"UI plane (GPU)",x:720,y:550,w:136,h:156,icon:"layers"},{id:"composition",title:"Final Composition",label:"Composition",subtitle:"composer",x:820,y:350,w:136,h:156,icon:"stack"},{id:"panel",title:"Display Panel",label:"Panel",subtitle:"panel",x:810,y:100,w:156,h:176,icon:"monitor",shape:"square",neon:"cyan",iconScale:1.2}],[]),[f,D]=d.useState(g),P=d.useMemo(()=>[{from:"appRender",to:"macBypass",excluded:!0},{from:"macBypass",to:"afxdp"},{from:"afxdp",to:"decoder"},{from:"decoder",to:"displayCtrl"},{from:"displayCtrl",to:"composition"},{from:"uiOverlay",to:"composition",excluded:!0},{from:"composition",to:"panel"}],[]),B=e=>({cx:e.x+e.w/2,cy:e.y+e.h/2}),T=(e,r)=>{const{cx:t,cy:o}=B(e),{cx:i,cy:a}=B(r),l=i-t,n=a-o,p=Math.abs(l)>=Math.abs(n);let c=t,x=o,h=0,v=0;p?l>=0?(c=e.x+e.w,h=1):(c=e.x,h=-1):n>=0?(x=e.y+e.h,v=1):(x=e.y,v=-1);let m=i,y=a,$=0,_=0;p?l>=0?(m=r.x,$=-1):(m=r.x+r.w,$=1):n>=0?(y=r.y,_=-1):(y=r.y+r.h,_=1);const W=Math.hypot(m-c,y-x),j=Math.min(120,Math.max(40,W/3)),H=c+h*j,I=x+v*j,O=m+$*j,U=y+_*j;return`M ${c} ${x} C ${H} ${I}, ${O} ${U}, ${m} ${y}`},w=d.useMemo(()=>{const e=Math.min(...g.map(o=>o.x)),t=Math.max(...g.map(o=>o.x+o.w))-e;return(u-t)/2-e},[g,u]),k=d.useRef({id:null,dx:0,dy:0}),R=e=>{const r=C.current;if(!r)return{x:0,y:0};const t=r.getScreenCTM();if(!t)return{x:0,y:0};const o=new DOMPoint(e.clientX,e.clientY).matrixTransform(t.inverse());return{x:o.x,y:o.y}};d.useEffect(()=>{const e=t=>{const o=k.current;if(!o.id)return;const i=R(t),a=i.x-w;D(l=>l.map(n=>n.id===o.id?{...n,x:a-o.dx,y:i.y-o.dy}:n))},r=()=>{k.current={id:null,dx:0,dy:0}};return window.addEventListener("pointermove",e),window.addEventListener("pointerup",r),()=>{window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",r)}},[w]);const E=(e,r)=>{const t=L.current;if(!t)return;const o=t.getBoundingClientRect();A({x:e.clientX-o.left+12,y:e.clientY-o.top+12,text:r})},X=()=>A(null);return d.useEffect(()=>{},[]),s.jsx(Y,{children:s.jsxs("div",{ref:L,className:"relative w-full aspect-[16/9] select-none",children:[s.jsx("style",{children:"@keyframes dashMove { to { stroke-dashoffset: -16; } }"}),s.jsxs("svg",{ref:C,viewBox:`0 0 ${u} ${z}`,className:"w-full h-full",role:"img","aria-label":"Interactive pipeline diagram",onMouseLeave:()=>{N(null),X()},children:[s.jsx("text",{x:u/2,y:42,textAnchor:"middle",className:"label fill-current font-bold text-4xl",children:"Sub-2 ms Video Pipeline"}),s.jsx("text",{x:u/2,y:70,textAnchor:"middle",className:"label fill-current text-muted-foreground text-lg",children:"Wi-Fi MAC-Level Bypass to Direct Display"}),s.jsxs("g",{transform:`translate(${w}, 0)`,children:[P.map((e,r)=>{const t=f.find(l=>l.id===e.from),o=f.find(l=>l.id===e.to),i=T(t,o),a=M===t.id||M===o.id;return s.jsx("g",{className:"drop-shadow",children:s.jsx("path",{d:i,className:`fill-none stroke-current ${e.color?"text-primary":""} ${e.excluded?"opacity-50 text-muted-foreground [stroke-dasharray:2_6]":"animate-[dashMove_1.2s_linear_infinite] [stroke-dasharray:6_8]"}`,strokeWidth:a?3.5:2.5,markerEnd:"url(#arrow)"})},r)}),s.jsx("defs",{children:s.jsx("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"8",markerHeight:"8",orient:"auto-start-reverse",children:s.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",className:"fill-current"})})}),f.map(e=>{const r=M===e.id,t=Math.round(100*(e.iconScale??1)),o=Math.max(t/2+6,Math.min(e.w,e.h)/2-4),i=e.x+e.w/2,a=e.y+e.h/2-10,l=Math.min(e.y+e.h+6,a+t/2+48);return s.jsxs("g",{className:"cursor-pointer",onPointerDown:n=>{const p=R(n);k.current={id:e.id,dx:p.x-(e.x+w),dy:p.y-e.y}},onMouseEnter:n=>{N(e.id),E(n,`${e.title}${e.subtitle?" — "+e.subtitle:""}`)},onMouseMove:n=>E(n,`${e.title}${e.subtitle?" — "+e.subtitle:""}`),onMouseLeave:()=>{N(null),X()},children:[e.shape==="square"?s.jsx("rect",{x:i-o,y:a-o,width:o*2,height:o*2,rx:14,ry:14,className:`drop-shadow-md ${r?"fill-[#dbe9ff] stroke-blue-600":"fill-[#eaf1fb] stroke-slate-400"} ${e.neon==="magenta"?"drop-shadow-[0_0_16px_rgba(255,43,214,.45)]":e.neon==="cyan"?"drop-shadow-[0_0_16px_rgba(0,229,255,.45)]":""}`}):s.jsx("circle",{cx:i,cy:a,r:o,className:`drop-shadow-md ${r?"fill-[#dbe9ff] stroke-blue-600":"fill-[#eaf1fb] stroke-slate-400"}`}),e.icon==="click"&&s.jsx(F,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),e.icon==="swap"&&s.jsx(G,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),e.icon==="xdp"&&s.jsx("svg",{x:i-t/2,y:a-t/2,width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:"stroke-current text-foreground",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M3 12h6l3 6 3-12 3 6h3"})}),e.icon==="scan"&&s.jsx(q,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),e.icon==="monitor"&&s.jsx(K,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),e.icon==="blocks"&&s.jsx(V,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),e.icon==="layers"&&s.jsx(Z,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),e.icon==="stack"&&s.jsx(J,{x:i-t/2,y:a-t/2,size:t,className:"text-foreground"}),s.jsx("text",{x:i,y:l,textAnchor:"middle",className:"label fill-current font-bold text-[28px]",children:e.label})]},e.id)}),(()=>{const e=f.find(c=>c.id==="appRender"),r=f.find(c=>c.id==="panel"),t=e.x+e.w/2+80,o=e.y+e.h/2-10,i=r.x+r.w/2-80,a=r.y+r.h/2-10,l=80,n=18,p=[];for(let c=0;c<=l;c++){const x=c/l,h=t+(i-t)*x,m=o+(a-o)*x+Math.sin(x*Math.PI*6)*n;p.push(c===0?`M ${h} ${m}`:`L ${h} ${m}`)}return s.jsxs("g",{children:[s.jsx("path",{d:p.join(" "),strokeWidth:2,className:"fill-none stroke-current text-primary animate-[dashMove_1.6s_linear_infinite] [stroke-dasharray:8_10]",markerEnd:"url(#arrow_primary)"}),s.jsx("text",{x:(t+i)/2,y:(o+a)/2-n-8,textAnchor:"middle",className:"label fill-current text-primary font-bold text-3xl",children:"≤ 2 ms"})]})})(),s.jsx("defs",{children:s.jsx("marker",{id:"arrow_primary",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"8",markerHeight:"8",orient:"auto-start-reverse",children:s.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",className:"fill-primary"})})}),s.jsx("g",{children:s.jsx("text",{x:80,y:310,textAnchor:"middle",className:"label fill-current text-muted-foreground text-xs",children:"Network Transport Excluded"})})]})]}),b&&s.jsx("div",{className:"absolute bg-white/95 border border-slate-200 rounded-md px-2 py-1 text-xs text-slate-700 pointer-events-none shadow-md",style:{left:b.x,top:b.y},children:b.text}),s.jsxs("a",{href:"https://github.com/c01-in/sub2ms-video-pipeline",target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-2 left-3 inline-flex items-center gap-2 px-2 py-1 rounded-md border bg-white/95 text-xs text-slate-700 shadow-sm hover:bg-white",title:"Open the project on GitHub",children:[s.jsx(Q,{className:"w-4 h-4"}),s.jsx("span",{className:"text-slate-700",children:"GitHub"})]}),s.jsx("div",{className:"absolute bottom-0 right-4 text-[11px] text-muted-foreground",children:"Hover nodes to highlight paths."})]})})}export{xe as default};
